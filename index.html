<meta name="robots" content="noindex,nofollow,noarchive,noimageindex,nosnippet">
<!doctype html>
<html lang="zh-Hant">
<head>
  <!-- æ”¾åœ¨æ•´ä»½ <style> çš„æœ€å°¾ç«¯ï¼›æˆ–åŠ ä¸€å€‹æ–°çš„ <style> ä¹Ÿè¡Œ -->
<style>
/* === Drawer / FAB çµ‚æ¥µä¿®è£œï¼ˆè«‹æ”¾åœ¨ <style> æœ€å°¾ç«¯ï¼‰=== */

/* 1) æŠ½å±œæ°¸é å£“éé®ç½©ï¼ˆè¦†è“‹æ‰ html[data-mode="mobile"] .sidebar çš„ 120ï¼‰ */
html[data-mode="mobile"] .sidebar,
.sidebar { z-index: 1001 !important; isolation: isolate; }
.backdrop { z-index: 1000 !important; }

/* 2) å¼·åˆ¶ã€Œæ‰‹æ©Ÿæ¨¡å¼ã€æ™‚ä¹Ÿè¦çœ‹å¾—åˆ° FABï¼ˆä¸è¦æ”¾åœ¨ @media è£¡ï¼‰ */
html[data-mode="mobile"]  .menu-fab { display:block !important; }
html[data-mode="desktop"] .menu-fab { display:none  !important; }

/* 3) ä¿éšªï¼šå´æ¬„é–‹å•Ÿæ™‚ä¸€å®šæ»‘å‡ºä¾† */
.sidebar.open { transform: translateX(0) !important; }
/* === Drawer / FAB çµ‚æ¥µä¿®è£œï¼ˆè«‹æ”¾åœ¨ <style> æœ€å°¾ç«¯ï¼‰=== */
html[data-mode="mobile"] .sidebar,
.sidebar { z-index: 1001 !important; isolation: isolate; }  /* å£“é 120 */
.backdrop { z-index: 1000 !important; }

/* æŠ½å±œé–‹å•Ÿæ™‚ä¸€å®šæ»‘å‡ºä¾†ï¼ˆé¿å… transform è¢«å…¶ä»–è¦å‰‡è¦†è“‹ï¼‰ */
.sidebar.open { transform: translateX(0) !important; }

/* å¼·åˆ¶æ¨¡å¼ä¸‹ FAB é¡¯ç¤ºï¼šä¸è¦å¯«åœ¨ @media è£¡ */
html[data-mode="mobile"]  .menu-fab { display:block !important; }
html[data-mode="desktop"] .menu-fab { display:none  !important; }

</style>

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>ç‰¹å¯µé£²é£Ÿç…§é¡§æ³¨æ„äº‹é …ï¼ˆä¸»é ï¼‰</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" defer></script>

<style>
  :root{
    color-scheme: dark;
    --bg:#000; --panel:#111827; --line:#374151; --ink:#fff; --muted:#94a3b8;
    --brand:#60a5fa; --chip:#1f2937; --chip-b:#374151;
    --ui:1;
  }
  html,body{margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang TC","Microsoft JhengHei","Noto Sans TC",sans-serif}
  body{font-size:calc(16px * var(--ui)); line-height:1.7; -webkit-text-size-adjust:100%}
  .topbar{position:sticky; top:0; z-index:100; background:rgba(0,0,0,.72); backdrop-filter:blur(10px); border-bottom:1px solid var(--line)}
  .topbar-inner{display:flex; align-items:center; gap:12px; padding:10px 12px}
  .brand{display:flex; align-items:center; gap:10px; font-weight:800}
  .brand .dot{width:10px; height:10px; border-radius:99px; background:var(--brand)}
  .brand .title{color:#c7d2fe}
  .grow{flex:1}
  .chip{background:var(--chip); border:1px solid var(--chip-b); color:var(--ink); padding:6px 10px; border-radius:999px; cursor:pointer}
  .chip.active{background:#4f46e5; border-color:#4338ca}
  .view-dock, .zoom-dock, .mode-dock{display:flex; gap:6px; align-items:center; flex-wrap:wrap}

  .shell{display:grid; grid-template-columns:260px 1fr; min-height:100vh}
  .sidebar{border-right:1px solid var(--line); padding:16px 12px; position:sticky; top:52px; align-self:start; height:calc(100vh - 52px); overflow:auto; background:var(--bg)}
  .nav{display:grid; gap:8px; margin-bottom:16px}
  .navlink{display:block; padding:8px 10px; border-radius:8px; background:transparent; border:1px solid var(--line); color:var(--ink); cursor:pointer; text-decoration:none}
  .navlink.active{background:#111827; border-color:#4338ca}
  .meta{display:grid; gap:10px; margin-top:16px; font-size:.95rem}
  .tag{color:var(--muted); font-size:.9rem}

  .content{padding:16px; max-width:1280px; width:100%}
  .panel{display:none}
  .panel.active{display:block}
  .card{background:var(--panel); border:1px solid var(--line); border-radius:12px; padding:16px}
  .muted{color:var(--muted)}
  table{border-collapse:collapse; width:100%; font-size:.95rem}
  th,td{border:1px solid var(--line); padding:12px; vertical-align:top}
  thead th{background:#0b1220; position:sticky; top:0; z-index:1}
  table.responsive th:first-child, table.responsive td:first-child{ position:sticky; left:0; background:#0b1220; z-index:2; }

  .t-green{color:#22c55e}.t-yellow{color:#facc15}.t-red{color:#b91c1c}.t-redlite{color:#f87171}.t-sky{color:#7dd3fc}.t-purple{color:#d8b4fe}
  .scrollbox{position:relative; overflow:auto; -webkit-overflow-scrolling:touch; border:1px solid #30363d; border-radius:10px; background:#0b0b0b}
  .wider{min-width:1100px}
  .pager{position:sticky; bottom:0; display:flex; gap:8px; align-items:center; background:rgba(17,24,39,.78); border-top:1px solid var(--line); padding:10px 12px}
  .btn{padding:6px 10px; border:1px solid var(--chip-b); border-radius:10px; background:var(--chip); color:var(--ink); cursor:pointer; display:inline-flex; align-items:center; gap:6px}
  .btn.active{background:#4f46e5; border-color:#4338ca}
  a.link{ color:#60a5fa; text-decoration:none } a.link:hover{text-decoration:underline}

  /* â€”â€” è¡Œå‹•ç‰ˆæŠ½å±œå´æ¬„ â€”â€” */
  .menu-fab{position:fixed; left:12px; bottom:max(12px, env(safe-area-inset-bottom)); z-index:130; display:none}
  .backdrop{ position:fixed; inset:52px 0 0 0; background:rgba(0,0,0,.4); backdrop-filter:blur(2px); z-index:110; display:none }
  @media(max-width: 1023px){
    .shell{grid-template-columns:1fr}
    .sidebar{
      position:fixed; top:52px; bottom:0; left:0; width:min(82vw, 320px);
      transform:translateX(-105%); transition:transform .25s ease; z-index:120; display:block;
    }
    .sidebar.open{ transform:translateX(0) }
    .menu-fab{display:block}
  }
  .backdrop.show{ display:block }

  html[data-mode="mobile"] .shell{grid-template-columns:1fr}
  html[data-mode="mobile"] .sidebar{ position:fixed; top:52px; bottom:0; left:0; width:min(82vw, 320px); transform:translateX(-105%); transition:transform .25s ease; z-index:120; display:block }
  html[data-mode="desktop"] .shell{grid-template-columns:260px 1fr}
  html[data-mode="desktop"] .sidebar{position:sticky; transform:none}

  html.light{ --bg:#f8fafc; --panel:#ffffff; --line:#e5e7eb; --ink:#0f172a; --muted:#475569; --chip:#f1f5f9; --chip-b:#cbd5e1; }
  .swipehint{position:fixed; left:50%; transform:translateX(-50%); bottom:max(8px, env(safe-area-inset-bottom)); z-index:50;
    background:rgba(17,24,39,.78); border:1px solid var(--line); padding:6px 10px; border-radius:999px; color:var(--muted); font-size:.9rem}

  @media (max-width: 900px){
    html:not([data-mode="desktop"]) .wider{ min-width: unset !important; }
    html:not([data-mode="desktop"]) .pager{ display:none !é‡è¦; }
    html:not([data-mode="desktop"]) table.responsive{ display:block !é‡è¦; }
    html:not([data-mode="desktop"]) table.responsive thead{ display:none !é‡è¦; }
    html:not([data-mode="desktop"]) table.responsive tbody{ display:block !é‡è¦; }
    html:not([data-mode="desktop"]) table.responsive tr{
      display:block !é‡è¦; margin:12px 0 !é‡è¦; border:1px solid var(--line) !é‡è¦;
      border-radius:12px !é‡è¦; background:#0b0b0b !é‡è¦;
    }
    html:not([data-mode="desktop"]) table.responsive td{
      display:flex !é‡è¦; gap:10px !é‡è¦; border:none !é‡è¦; border-bottom:1px solid var(--line) !é‡è¦;
      padding:10px 12px !é‡è¦; align-items:flex-start !é‡è¦;
    }
    html:not([data-mode="desktop"]) table.responsive td:last-child{ border-bottom:none !é‡è¦; }
    html:not([data-mode="desktop"]) table.responsive td::before{
      content: attr(data-label) !é‡è¦; flex:0 0 6.5rem !é‡è¦; color:var(--muted) !é‡è¦; font-weight:600 !é‡è¦;
    }
    html:not([data-mode="desktop"]) table.responsive td[data-label="ç‰©ç¨®åˆ†ç¾¤"]{ font-weight:700; font-size:1.05rem; }
  }

  /* â€”â€” åœ–è¡¨ UI â€”â€” */
  #chartBox{position:relative}
  #chartCanvas{ width:100% !important; max-width:600px; height:auto !important; display:block; margin:auto; }
  html[data-ctype="bar"]  #chartCanvas{ aspect-ratio:16/10; }
  html[data-ctype="pie"]  #chartCanvas{ aspect-ratio:1/1; }
  .legend{display:grid;gap:10px}
  .legend .item{display:flex;align-items:center;gap:10px;cursor:pointer}
  .dot{width:10px;height:10px;border-radius:50%}
  .i-green{background:#22c55e}.i-yellow{background:#facc15}.i-red{background:#b91c1c}.i-redlite{background:#f87171}
  .blocks{display:grid;gap:14px}
  .blk{border:1px solid var(--line);border-radius:12px;padding:14px;background:#0b0b0b}
  .blk h4{margin:0 0 6px}
  .blk.green{background:linear-gradient(0deg,#0e2016,#0e2016)}
  .blk.yellow{background:linear-gradient(0deg,#201e0c,#201e0c)}
  .blk.red{background:linear-gradient(0deg,#211013,#211013)}
  .blk.redlite{background:linear-gradient(0deg,#1f1315,#1f1315)}
  .hl{outline:2px solid #7dd3fc; outline-offset:2px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .speciesBar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:14px}
  .title{font-size:22px;font-weight:800;margin:0 0 4px}
  .note{
    position:absolute; left:0; top:0; transform:translate(-50%,-110%);
    background:#0b1220cc; border:1px solid var(--line); color:var(--ink);
    padding:8px 10px; border-radius:10px; font-size:14px; max-width:320px;
    backdrop-filter:blur(6px); pointer-events:none; z-index:3;
    box-shadow:0 6px 20px rgba(0,0,0,.35);
  }
  .note .head{display:flex;align-items:center;gap:8px;font-weight:700;margin-bottom:4px}
  @media (max-width:640px){
    html[data-ctype="bar"] #chartCanvas{aspect-ratio:4/3}
  }

/* Drawer å±¤ç´šä¿®è£œ */
.sidebar { z-index: 1001; isolation: isolate; }
.backdrop { z-index: 1000; }
.sidebar.open { transform: translateX(0) !important; }

/* æŸäº›æ©Ÿå‹å° backdrop-filter æœ‰ç–Šå±¤ bugï¼šè¡Œå‹•ç«¯ç§»é™¤æ¨¡ç³Šä½†ä¿ç•™é®ç½© */
@media (max-width: 1023px){
  .backdrop.show { backdrop-filter: none; background: rgba(0,0,0,.45); }
}
/* å¼·åˆ¶æ¨¡å¼ä¸‹ FAB é¡¯ç¤ºè¦å‰‡ï¼ˆä¸è¦æ”¾åœ¨ @media è£¡ï¼‰ */
html[data-mode="mobile"]  .menu-fab { display:block !important; }
html[data-mode="desktop"] .menu-fab { display:none  !important; }
</style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <span class="dot"></span>
        <span class="title">ç‰¹å¯µé£²é£Ÿç…§é¡§æ³¨æ„äº‹é …ï¼ˆä¸»é ï¼‰</span>
      </div>
      <div class="grow"></div>
        <button id="toApps" class="chip" title="å›åˆ‡æ› App" aria-label="å›åˆ‡æ› App">â†©ï¸ åˆ‡æ› App</button>
      <div class="view-dock" aria-label="æª¢è¦–åˆ‡æ›">
        <button class="chip" data-view="table" title="è¡¨æ ¼" aria-pressed="true">è¡¨æ ¼</button>
        <button class="chip" data-view="bar"   title="é•·æ¢åœ–" aria-pressed="false">é•·æ¢</button>
        <button class="chip" data-view="pie"   title="åœ“é¤…åœ–" aria-pressed="false">åœ“é¤…</button>
      </div>
      <div class="zoom-dock" aria-label="ç¸®æ”¾">
        <button id="fontDec" class="chip" title="å­—é«”ç¸®å°">Aâˆ’</button>
        <button id="fontInc" class="chip" title="å­—é«”æ”¾å¤§">Aï¼‹</button>
        <button id="resetAll" class="chip" title="é‡ç½®">â†º</button>
      </div>
      <div class="mode-dock" aria-label="è£ç½®æ¨¡å¼">
        <button id="modeAuto" class="chip">è‡ªå‹•</button>
        <button id="modeMobile" class="chip">æ‰‹æ©Ÿ</button>
        <button id="modeDesktop" class="chip">æ¡Œæ©Ÿ</button>
      </div>
    </div>
  </header>

  <div class="shell">
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="å´æ¬„">
      <nav class="nav">
        <a class="navlink active" data-section="apps">1 åˆ‡æ› App</a>
        <a class="navlink" data-section="intro">2 ç°¡ä»‹</a>
        <a class="navlink" data-section="risks">3 ç–¾ç—…é¢¨éšª / åŸºå› ç¼ºé™·</a>
        <a class="navlink" data-section="diet">4 ç‰¹å¯µé£²é£Ÿæ³¨æ„äº‹é …ï¼ˆåœ–è¡¨/è¡¨æ ¼ï¼‰</a>
        <a class="navlink" data-section="sources">5 ä¾†æºè³‡æ–™</a>
        <a class="navlink" data-section="summary">6 ç¸½çµ</a>
      </nav>
      <div class="meta">
        <div>æ›´æ–°ï¼š<span id="now"></span></div>
        <button id="toggleDark" class="chip">æ·±è‰² UI</button>
        <div class="mode-dock">
          <button id="mAuto" class="chip">è‡ªå‹•</button>
          <button id="mMobile" class="chip">æ‰‹æ©Ÿ</button>
          <button id="mDesktop" class="chip">æ¡Œæ©Ÿ</button>
        </div>
        <div class="tag">å¾å·¦é‚Šç·£å³æ»‘æˆ–é»ã€Œç›®éŒ„ã€é–‹å•Ÿ</div>
      </div>
    </aside>

    <main class="content" id="content" tabindex="-1">
      <!-- 1 åˆ‡æ› App -->
      <section class="panel active" data-panel="apps">
        <div class="card">
          <h2>1ï½œåˆ‡æ› App</h2>
          <p class="muted">ä¸‰å€‹æŒ‰éˆ•åˆ†åˆ¥é–‹æ–°åˆ†é ã€‚</p>
          <div style="display:flex;flex-wrap:wrap;gap:10px">
            <a class="btn" href="./fmg4/index.html" target="_blank" rel="noopener">
              <i class="fa-solid fa-chart-line"></i> ç‰¹å¯µè¶¨å‹¢ app
            </a>
            <a class="btn" href="./raw/index.html" target="_blank" rel="noopener">
              <i class="fa-solid fa-flask"></i> ç‰¹å¯µå…¨æ–¹ä½ç±³çŸ¥æ¯›ç ”ç›Šç”ŸèŒæˆåˆ†è¡¨
            </a>
            <a class="btn" href="./lab/index.html" target="_blank" rel="noopener">
              <i class="fa-solid fa-wrench"></i> å¾…é–‹ç™¼
            </a>
          </div>
        </div>
      </section>

      <!-- 2 ç°¡ä»‹ -->
      <section class="panel" data-panel="intro">
        <div class="card">
          <h2>2ï½œç°¡ä»‹</h2>
          <p>é–‹ç™¼ç ”ç©¶å°ˆç”¨appç¶²é åˆ‡æ›appsè§€çœ‹å…¶é¤˜è³‡æ–™</p>
        </div>
      </section>

      <!-- 3 ç–¾ç—…é¢¨éšªï¼åŸºå› ç¼ºé™· -->
      <section class="panel" data-panel="risks">
        <div class="card">
          <h2>3ï½œç–¾ç—…é¢¨éšªï¼åŸºå› ç¼ºé™·</h2>
          <p class="muted">ä¾å¸¸è¦‹ç‰¹å¯µåˆ†ç¾¤å½™æ•´ã€‚å¯¦éš›è¨ºç™‚ä»ä»¥å°ˆç§‘ç¸é†«åˆ¤è®€ç‚ºæº–ã€‚</p>
          <div class="scrollbox">
            <div class="wider">
              <table class="responsive">
                <thead>
                  <tr>
                    <th>ç‰©ç¨®åˆ†ç¾¤</th>
                    <th>å¸¸è¦‹ç–¾ç—…ï¼ç‡Ÿé¤Šç—‡</th>
                    <th>åŸºå› ç¼ºé™·ï¼çˆ­è­°å“ç³»</th>
                  </tr>
                </thead>
                <tbody id="riskBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- 4 é£²é£Ÿæ³¨æ„äº‹é …ï¼ˆåŸè¡¨/åœ–ï¼‰ -->
      <section class="panel" data-panel="diet">
        <div class="card">
          <h2>4ï½œç‰¹å¯µé£²é£Ÿæ³¨æ„äº‹é …ï¼ˆè¡¨æ ¼/é•·æ¢/åœ“é¤…ï¼‰</h2>
          <p class="muted">æ”¯æ´æ®µä½è·³è½‰ 1/2/3ã€å­—ç´šç¸®æ”¾ï¼Œä»¥åŠåœ–è¡¨é¡å‹åˆ‡æ›ã€‚</p>

          <!-- è¡¨æ ¼è¦–åœ– -->
          <div id="view-table">
            <div class="scrollbox" id="sb-table">
              <div class="wider">
                <table class="responsive">
                  <thead>
                    <tr>
                      <th>ç‰©ç¨®åˆ†ç¾¤</th>
                      <th class="t-green">å¿…éœ€</th>
                      <th class="t-yellow">å¯é¸</th>
                      <th><span class="t-red">â›” é¿å…</span> / <span class="t-redlite">âš ï¸ ä¸å»ºè­°</span></th>
                      <th class="t-sky">çµ¦æ³•</th>
                      <th class="t-purple">ç¯€å¥</th>
                    </tr>
                  </thead>
                  <tbody id="tbody"></tbody>
                </table>
              </div>
              <div class="pager" data-pager="#sb-table">
                <span class="muted">å·¦å³è·³ï¼š</span>
                <button class="btn" data-dir="left"  data-step="1"><i class="fa-solid fa-angles-left"></i> 1</button>
                <button class="btn" data-dir="left"  data-step="2"><i class="fa-solid fa-angle-left"></i> 2</button>
                <button class="btn" data-dir="left"  data-step="3"><i class="fa-solid fa-chevron-left"></i> 3</button>
                <button class="btn" data-dir="right" data-step="1">1 <i class="fa-solid fa-angles-right"></i></button>
                <button class="btn" data-dir="right" data-step="2">2 <i class="fa-solid fa-angle-right"></i></button>
                <button class="btn" data-dir="right" data-step="3">3 <i class="fa-solid fa-chevron-right"></i></button>
              </div>
            </div>
          </div>

          <!-- åœ–è¡¨è¦–åœ– -->
          <div id="view-chart" style="display:none">
            <div class="scrollbox" id="sb-chart">
              <div class="wider" style="padding:12px">
                <div class="row" style="display:flex;gap:16px;align-items:center;flex-wrap:wrap">
                  <div>
                    <div class="title">åœ–è¡¨åˆ‡æ›</div>
                    <div class="muted">ç›®å‰é¡¯ç¤ºï¼š<span id="currentName">â€”</span></div>
                  </div>
                  <div class="toolbar" id="cToolbar" aria-label="åœ–è¡¨é¡å‹">
                    <button class="btn" data-ctype="bar">é•·æ¢</button>
                    <button class="btn" data-ctype="pie">åœ“é¤…</button>
                  </div>
                </div>

                <div class="hstack" style="display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap; margin-top:14px">
                  <div class="col" id="chartBox" style="flex:1;min-width:260px">
                    <canvas id="chartCanvas"></canvas>
                    <div id="note" class="note" hidden></div>
                  </div>
                  <div class="col legend" id="legendBox" style="flex:1;min-width:260px">
                    <div class="muted" style="margin-bottom:6px">åœ–ä¾‹ï¼ˆé»æ“Šé«˜äº®å¡ç‰‡ / åœ¨åœ–ä¸Šé¡¯ç¤ºè¨»è§£ï¼‰</div>
                    <div class="item" data-key="essential"><span class="dot i-green"></span><div>å¿…éœ€ â€” <span class="muted" id="l-eg"></span></div></div>
                    <div class="item" data-key="optional"><span class="dot i-yellow"></span><div>å¯é¸ â€” <span class="muted" id="l-op"></span></div></div>
                    <div class="item" data-key="avoid"><span class="dot i-red"></span><div>é¿å… â€” <span class="muted" id="l-av"></span></div></div>
                    <div class="item" data-key="not"><span class="dot i-redlite"></span><div>ä¸å»ºè­° â€” <span class="muted" id="l-no"></span></div></div>
                  </div>
                </div>

                <div class="card" style="margin-top:14px; background:transparent; border:none; padding:0">
                  <div class="blocks" id="blocks"></div>
                </div>

                <div class="card" style="margin-top:14px; background:transparent; border:none; padding:0">
                  <div class="speciesBar" id="speciesChips"></div>
                </div>
              </div>

              <div class="pager" data-pager="#sb-chart">
                <span class="muted">å·¦å³è·³ï¼š</span>
                <button class="btn" data-dir="left"  data-step="1"><i class="fa-solid fa-angles-left"></i> 1</button>
                <button class="btn" data-dir="left"  data-step="2"><i class="fa-solid fa-angle-left"></i> 2</button>
                <button class="btn" data-dir="left"  data-step="3"><i class="fa-solid fa-chevron-left"></i> 3</button>
                <button class="btn" data-dir="right" data-step="1">1 <i class="fa-solid fa-angles-right"></i></button>
                <button class="btn" data-dir="right" data-step="2">2 <i class="fa-solid fa-angle-right"></i></button>
                <button class="btn" data-dir="right" data-step="3">3 <i class="fa-solid fa-chevron-right"></i></button>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- 5 ä¾†æºè³‡æ–™ -->
      <section class="panel" data-panel="sources">
        <div class="card">
          <h2>5ï½œä¾†æºè³‡æ–™</h2>
          <ul id="dev-refs"></ul>
        </div>
      </section>

      <!-- 6 ç¸½çµ -->
      <section class="panel" data-panel="summary">
        <div class="card">
          <h2>6ï½œç¸½çµ</h2>
          <ul class="bullets">
            <li><b>å“é¡ç­–ç•¥ï¼š</b>ä»¥ã€Œç‡Ÿé¤Šé¢¨éšªæœ€é«˜çš„æ—ç¾¤ã€åšåˆ‡å…¥ï¼ˆè‰é£Ÿå‹çˆ¬èŸ²ã€èœœè¢‹é¼¯ã€å¹¼é«”/æ›é£¼æœŸï¼‰ï¼Œæ¨™æº–åŒ– Ca/D3 èˆ‡çº–ç¶­æ–¹æ¡ˆã€‚</li>
            <li><b>ç”¢å“çŸ©é™£ï¼š</b>Ca/D3ã€UVBçŸ¥è­˜å¡ã€ç›Šç”ŸèŒï¼ˆè€ç†±æ ªï¼‰ã€é›»è§£è³ªï¼›æŒ‰ç‰©ç¨®è²¼æ¨™ã€‚</li>
            <li><b>å•†æ©Ÿï¼š</b>æ•™è‚²ï¼‹é…æ–¹é›™è¼ªï¼šç”¨åœ–è¡¨è¦–è¦ºåŒ–ã€ŒéŒ¯èª¤é¤µé£Ÿâ†’ç–¾ç—…é¢¨éšªã€ï¼Œå¸¶å‡ºé…æ–¹å‡ç´šã€‚</li>
          </ul>
        </div>
      </section>
    </main>
  </div>

  <!-- è¡Œå‹•ç‰ˆï¼šèƒŒæ™¯é®ç½© + ç›®éŒ„ FAB -->
  <div class="backdrop" id="backdrop" aria-hidden="true"></div>
  <button id="menuFab" class="menu-fab chip" aria-controls="sidebar" aria-expanded="false" title="é–‹å•Ÿç›®éŒ„">ğŸ“‘ ç›®éŒ„</button>

  <div class="swipehint">â† å·¦å³æ»‘å¯æ›åˆ†é ï¼›ç”±å·¦é‚Šç·£å³æ»‘å¯é–‹å•Ÿç›®éŒ„</div>

<script>
/* ====== å›ºå®šè³‡æ–™ï¼ˆé£²é£Ÿè¡¨/åœ–ï¼‰ ====== */
const DATA = {
  "æ˜†èŸ²é£Ÿèœ¥èœ´/å®ˆå®®": { essential: 2, optional: 2, avoid: 1, not: 1, details: {
    essential:"éˆ£ + UVB/D3", optional:"ä½é »ç¶œåˆç¶­ä»–å‘½ã€ç›Šç”ŸèŒ", avoid:"â›” é­šæ²¹/è‚æ²¹", not:"âš ï¸ ç‹—è²“ç³§" } },
  "è‰é£Ÿèœ¥èœ´/é™¸é¾œ": { essential: 3, optional: 2, avoid: 2, not: 1, details: {
    essential:"é«˜çº–è‰æœ¬ä¸»é£Ÿ + éˆ£ç²‰ + UVB", optional:"ä½é »ç¶­ä»–å‘½ã€é›»è§£è³ª", avoid:"â›” é«˜è›‹ç™½/é«˜è„‚ã€â›” éé‡æ°´æœã€âš ï¸ é­šæ²¹/è‚æ²¹", not:"" } },
  "æ°´é¾œ/åŠæ°´é¾œ": { essential: 3, optional: 2, avoid: 1, not: 1, details: {
    essential:"å‡è¡¡é£¼æ–™ + éˆ£æº + æ—¥ç…§/UVB", optional:"ä½é »ç¶œåˆç¶­ä»–å‘½ã€ç›Šç”ŸèŒ", avoid:"â›” ç‹—è²“ç³§", not:"âš ï¸ è‚æ²¹" } },
  "è›‡": { essential: 1, optional: 1, avoid: 1, not: 1, details: {
    essential:"å®Œæ•´çµç‰©", optional:"ï¼ˆåƒ…éå¸¸æ…‹é£Ÿè­œæ™‚ä½é »ç¶­ä»–å‘½ï¼‰", avoid:"â›” é­šæ²¹/è‚æ²¹", not:"âš ï¸ ç¢è‚‰é•·æœŸé¤µ" } },
  "å…”/å¤©ç«ºé¼ /é¾è²“": { essential: 2, optional: 2, avoid: 2, not: 1, details: {
    essential:"ç„¡é™è‰ + é«˜çº–é¡†ç²’ã€Vit Cï¼ˆå¤©ç«ºé¼ ï¼‰", optional:"ç›Šç”ŸèŒã€é›»è§£è³ª", avoid:"â›” é«˜è„‚ã€â›” é«˜ç³–é›¶é£Ÿ", not:"âš ï¸ é­šæ²¹" } },
  "èœœè¢‹é¼¯": { essential: 3, optional: 2, avoid: 1, not: 1, details: {
    essential:"Ca:P>1.5:1ã€é…æ–¹è†³ + æ˜†èŸ²ã€D3", optional:"ä½é »ç¶­ä»–å‘½ã€é›»è§£è³ª", avoid:"â›” é«˜ç³–æ¼¿", not:"âš ï¸ é«˜è„‚æ²¹" } },
  "è /èœ˜è››": { essential: 2, optional: 0, avoid: 1, not: 1, details: {
    essential:"é¤ŒèŸ²ç‡Ÿé¤ŠåŒ–ï¼ˆgut-loadingï¼‰+ ä¹¾æ·¨æ°´", optional:"â€”", avoid:"â›” ç›´æ¥ç‘ç¶­ä»–å‘½", not:"âš ï¸ æ²¹è„‚é»é¤Œ" } },
};
const COLORS = { essential:"#22c55e", optional:"#facc15", avoid:"#b91c1c", not:"#f87171" };

/* ====== ç–¾ç—…é¢¨éšªï¼åŸºå› ç¼ºé™·ï¼ˆæ¸²æŸ“è³‡æ–™ï¼‰ ====== */
const RISKS = {
  "æ˜†èŸ²é£Ÿèœ¥èœ´/å®ˆå®®": {
    diseases: [
      "ä»£è¬æ€§éª¨ç—…ï¼ˆMBDï¼‰â€” Ca/D3/UVB ä¸è¶³é€ æˆéª¨éˆ£æµå¤±ã€éª¨éª¼è»Ÿå¼±",
      "è„«çš®ä¸å…¨ï¼ˆdysecdysisï¼‰ã€å£ç‚/å‘¼å¸é“æ„ŸæŸ“",
      "éš±å­¢å­èŸ²ï¼ˆCryptosporidium varaniiï¼‰é€ æˆæ¶ˆç˜¦/æ‹‰ç¨€ï¼ˆä¿—ç¨± stick tailï¼‰"
    ],
    genetics: [
      "è±¹ç´‹å®ˆå®® Enigma ç›¸é—œç¥ç¶“ç—‡å€™ç¾¤ï¼ˆæ—‹è½‰/è½‰åœˆç­‰ï¼Œå±¬çˆ­è­°å“ç³»ï¼‰"
    ]
  },
  "è‰é£Ÿèœ¥èœ´/é™¸é¾œ": {
    diseases: [
      "ä»£è¬æ€§éª¨ç—…ï¼ˆMBDï¼‰",
      "èƒŒç”²é‡‘å­—å¡”ï¼ˆpyramidingï¼‰â€” é«˜è›‹ç™½/ä½æ¿•åº¦/ä¸ç•¶ç’°å¢ƒç›¸é—œ",
      "ç¶­ç”Ÿç´ Aç¼ºä¹ã€å‘¼å¸é“æ„ŸæŸ“ã€è†¿è…«"
    ],
    genetics: [
      "é™¸é¾œå¸¸è¦‹ç‚ºé£¼é¤Šç’°å¢ƒå•é¡Œï¼Œç„¡ç‰¹å®šéºå‚³å“ç³»è­°é¡Œ"
    ]
  },
  "æ°´é¾œ/åŠæ°´é¾œ": {
    diseases: [
      "MBDèˆ‡è†³é£Ÿ/UVBå¤±è¡¡",
      "èƒŒç”²/çš®è†šæ„ŸæŸ“ï¼ˆshell rotï¼‰ã€å¯„ç”ŸèŸ²",
      "ç¶­ç”Ÿç´ Aç¼ºä¹å°è‡´çœ¼é¼»å•é¡Œ"
    ],
    genetics: ["æ°´é¾œè¼ƒå°‘è¦‹å“ç³»ç¼ºé™·"]
  },
  "è›‡": {
    diseases: [
      "å‘¼å¸é“æ„ŸæŸ“ã€æ¶ˆåŒ–ä¸è‰¯ã€æ‹’é£Ÿ",
      "å«é«”ç—…ï¼ˆIBDï¼Œboid inclusion body diseaseï¼‰"
    ],
    genetics: [
      "çƒèŸ’ã€Œèœ˜è››ï¼ˆSpiderï¼‰ã€ç­‰å“ç³» wobbleï¼ˆå‰åº­/å…§è€³çµæ§‹å·®ç•°ï¼‰",
      "åœ°æ¯¯èŸ’ Jaguar åŸºå›  wobbleï¼›é›™åŠ‘é‡å½¢å¼å¤šè‡´æ­»"
    ]
  },
  "å…”/å¤©ç«ºé¼ /é¾è²“": {
    diseases: [
      "èƒƒè…¸åœæ»¯ï¼ˆGI stasisï¼‰èˆ‡ä½çº–ã€é«˜ç³–é›¶é£Ÿç›¸é—œ",
      "é½’åˆ—ä¸æ­£ï¼ˆè‡¼é½’å°–åˆºï¼‰ã€è‚¥èƒ–",
      "æ¯å…”å­å®®è…ºç™Œï¼ˆæœªçµ•è‚²ç™¼ç”Ÿç‡é«˜ï¼‰",
      "å¤©ç«ºé¼ ç¶­ç”Ÿç´ Cç¼ºä¹ï¼ˆå£è¡€ç—…ï¼‰ï¼›é¾è²“æ˜“ä¸­æš‘"
    ],
    genetics: ["éƒ¨åˆ†å“ç³»è…«ç˜¤å‚¾å‘ï¼ˆå¦‚å¯µé¼ ï¼‰ï¼›å…”é•·æ¯›/çŸ®ç¨®éœ€æ³¨æ„ç‰™é½’çµæ§‹å•é¡Œ"]
  },
  "èœœè¢‹é¼¯": {
    diseases: [
      "ç‡Ÿé¤Šæ€§éª¨ç—…ï¼ˆCa:P å¤±è¡¡ã€D3ä¸è¶³ï¼‰â†’ å¾Œè‚¢ç„¡åŠ›/éº»ç—º",
      "è‚¥èƒ–ã€ç‰™å‘¨ç—…ã€å£“åŠ›ç›¸é—œè‡ªæ®˜"
    ],
    genetics: ["éƒ¨åˆ†èŠ±è‰²ç³»ï¼ˆç™½å­/æ·¡è‰²ï¼‰ç¹æ®–éœ€æ³¨æ„éºå‚³å¤šæ¨£æ€§"]
  },
  "è /èœ˜è››": {
    diseases: [
      "è„«æ°´èˆ‡è›»çš®éšœç¤™ï¼ˆä½æ¿•åº¦ï¼‰",
      "ï¼ˆç‹¼è››ï¼‰DKS å¤±èª¿ç—‡å€™ç¾¤ï¼šæˆå› æœªæ˜ï¼Œç—‡ç‹€ç‚ºé‹å‹•å¤±èª¿"
    ],
    genetics: ["ç„¡æ˜ç¢ºé¦´åŒ–å“ç³»ç¼ºé™·ï¼›ä»¥ç’°å¢ƒå› å­ç‚ºä¸»"]
  }
};

/* ====== é¢æ¿ / å°è¦½ ====== */
const panels = Array.from(document.querySelectorAll('.panel'));
const navlinks = Array.from(document.querySelectorAll('.navlink'));
function showPanel(name){
  panels.forEach(p=>p.classList.toggle('active', p.dataset.panel===name));
  navlinks.forEach(a=>a.classList.toggle('active', a.dataset.section===name));
}
document.addEventListener('click', e=>{
  const a=e.target.closest('.navlink'); if(a){ showPanel(a.dataset.section); }
});

/* ====== æª¢è¦–åˆ‡æ›ï¼ˆé ‚éƒ¨ chipsï¼‰ ====== */
const viewChips = Array.from(document.querySelectorAll('.view-dock .chip'));
let currentView = 'table';
let currentChartType = 'bar';
function setPressed(v){
  viewChips.forEach(c=>{
    const on = c.dataset.view===v;
    c.classList.toggle('active', on);
    c.setAttribute('aria-pressed', on);
  });
}
function applyView(v){
  currentView = v;
  setPressed(v);
  const isTable = (v==='table');
  document.getElementById('view-table').style.display = isTable ? '' : 'none';
  document.getElementById('view-chart').style.display = isTable ? 'none' : '';
  if(!isTable){
    currentChartType = (v==='bar' || v==='pie') ? v : currentChartType;
    ensureChartApp();
    setChartType(currentChartType);
  }
  location.hash = `view=${v}`;
}
document.querySelector('.view-dock').addEventListener('click', e=>{
  const c=e.target.closest('.chip[data-view]'); if(!c) return;
  applyView(c.dataset.view);
});
window.addEventListener('hashchange', ()=>{
  const m = location.hash.match(/view=(\w+)/);
  if(m) applyView(m[1]);
});

/* ====== å­—ç´šç¸®æ”¾ / é‡ç½® ====== */
const setUI = v => { document.documentElement.style.setProperty('--ui', v); localStorage.setItem('ui', v); };
const uiInit = localStorage.getItem('ui') || '1'; setUI(uiInit);
document.getElementById('fontDec').onclick=()=>setUI(Math.max(0.9,(+getComputedStyle(document.documentElement).getPropertyValue('--ui')||1)-0.05).toFixed(2));
document.getElementById('fontInc').onclick=()=>setUI(Math.min(1.4,(+getComputedStyle(document.documentElement).getPropertyValue('--ui')||1)+0.05).toFixed(2));
document.getElementById('resetAll').onclick=()=>{ setUI(1); };

/* ====== æ¨¡å¼åˆ‡æ›ï¼ˆç©©å®šç‰ˆï¼‰ ====== */
(function () {
  const root = document.documentElement;

  const sidebar  = document.getElementById('sidebar');
  const backdrop = document.getElementById('backdrop');
  const menuFab  = document.getElementById('menuFab');

  const btn = {
    auto:     document.getElementById('modeAuto'),
    mobile:   document.getElementById('modeMobile'),
    desktop:  document.getElementById('modeDesktop'),
    mAuto:    document.getElementById('mAuto'),
    mMobile:  document.getElementById('mMobile'),
    mDesktop: document.getElementById('mDesktop'),
  };

  function applyFabVisibility() {
    const forced = root.getAttribute('data-mode');
    const isMobileLike =
      forced === 'mobile' ||
      (forced !== 'desktop' && window.matchMedia('(max-width:1023px)').matches);

    if (menuFab) menuFab.style.display = isMobileLike ? 'block' : 'none';
  }

  function setMode(m) {
    if (m === 'auto') {
      root.removeAttribute('data-mode');
    } else {
      root.setAttribute('data-mode', m);
    }
    localStorage.setItem('mode', m);
    applyFabVisibility();

    if (m === 'desktop') {
      if (sidebar && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
      if (backdrop && backdrop.classList.contains('show')) {
        backdrop.classList.remove('show');
      }
      if (menuFab) menuFab.setAttribute('aria-expanded', 'false');
    }
  }

  btn.auto    && btn.auto.addEventListener('click',    () => setMode('auto'));
  btn.mobile  && btn.mobile.addEventListener('click',  () => setMode('mobile'));
  btn.desktop && btn.desktop.addEventListener('click', () => setMode('desktop'));
  btn.mAuto   && btn.mAuto.addEventListener('click',   () => setMode('auto'));
  btn.mMobile && btn.mMobile.addEventListener('click', () => setMode('mobile'));
  btn.mDesktop&& btn.mDesktop.addEventListener('click',() => setMode('desktop'));

  setMode(localStorage.getItem('mode') || 'auto');
  window.addEventListener('resize', applyFabVisibility);
  new MutationObserver(applyFabVisibility).observe(root, {
    attributes: true, attributeFilter: ['data-mode']
  });
})();

/* ====== æ·±è‰² UI åˆ‡æ› ====== */
const toggleDark = document.getElementById('toggleDark');
if(localStorage.getItem('theme')==='light') document.documentElement.classList.add('light');
toggleDark.onclick=()=>{
  document.documentElement.classList.toggle('light');
  localStorage.setItem('theme', document.documentElement.classList.contains('light')?'light':'dark');
};

/* ====== ç”Ÿæˆè¡¨æ ¼ï¼ˆé£²é£Ÿæ³¨æ„ï¼‰ ====== */
(function renderTable(){
  const helper = {
    "æ˜†èŸ²é£Ÿèœ¥èœ´/å®ˆå®®": { how:"é¤ŒèŸ²è–„ç‘ç²‰ã€UVBåˆ°ä½ç”¨ç„¡D3éˆ£", pace:"å«D3éˆ£ 1â€“2æ¬¡/é€±ï¼ˆç„¡UVB/å¹¼é«”ï¼‰" },
    "è‰é£Ÿèœ¥èœ´/é™¸é¾œ":   { how:"è‰ç‚ºä¸»ã€å¤šç¶ è‘‰èœã€éˆ£ç²‰è–„ç‘",   pace:"éˆ£ 2â€“3é¤/é€±ï¼›ç¶œç¶­ æ¯7â€“14å¤©" },
    "æ°´é¾œ/åŠæ°´é¾œ":     { how:"çƒè³Šéª¨/é«˜éˆ£é¤…ã€å°‘é‡è£œç²‰",       pace:"è£œç²‰ 2â€“4é€±/æ¬¡" },
    "è›‡":               { how:"ç¶­æŒæ•´éš»çµç‰©",                 pace:"ä¾é«”æ³ 7â€“14æ—¥/é¤" },
    "å…”/å¤©ç«ºé¼ /é¾è²“":   { how:"é€æ­¥æ›é£Ÿã€é«˜çº–ç¶­ç¶­æŒ",           pace:"ç›Šç”ŸèŒ 2â€“4é€±è©•ä¼°" },
    "èœœè¢‹é¼¯":           { how:"ä¾æ—¢å®šé…æ–¹ + è¦å¾‹éˆ£ç²‰",         pace:"éˆ£ å°é‡å¤šæ¬¡/é€±" },
    "è /èœ˜è››":         { how:"å°ˆæ³¨é¤Œæ–™å“è³ª",                   pace:"é¤Œæ–™æ®˜æ¸£å³æ™‚æ¸…" },
  };
  const body = document.getElementById('tbody');
  body.innerHTML = Object.keys(DATA).map(name=>{
    const d=DATA[name];
    const avoidHtml = [
      d.details.avoid ? `<span class="t-red">â›” ${d.details.avoid.replace(/^â›”\s*/,'')}</span>` : '',
      d.details.not   ? `<span class="t-redlite">âš ï¸ ${d.details.not.replace(/^âš ï¸\s*/,'')}</span>` : ''
    ].filter(Boolean).join('ã€');

    return `<tr>
      <td data-label="ç‰©ç¨®åˆ†ç¾¤">${name}</td>
      <td data-label="å¿…éœ€"  class="t-green">${d.details.essential || 'â€”'}</td>
      <td data-label="å¯é¸"  class="t-yellow">${d.details.optional || 'â€”'}</td>
      <td data-label="â›” é¿å… / âš ï¸ ä¸å»ºè­°">${avoidHtml || 'â€”'}</td>
      <td data-label="çµ¦æ³•"  class="t-sky">${helper[name].how}</td>
      <td data-label="ç¯€å¥"  class="t-purple">${helper[name].pace}</td>
    </tr>`;
  }).join('');
})();

/* ====== ç”Ÿæˆã€Œç–¾ç—…é¢¨éšªï¼åŸºå› ç¼ºé™·ã€è¡¨ ====== */
(function renderRisks(){
  const tbody = document.getElementById('riskBody');
  const esc = s => (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;');
  tbody.innerHTML = Object.entries(RISKS).map(([name, d])=>{
    const list = arr => '<ul>' + arr.map(x=>`<li>${esc(x)}</li>`).join('') + '</ul>';
    return `<tr>
      <td data-label="ç‰©ç¨®åˆ†ç¾¤">${esc(name)}</td>
      <td data-label="å¸¸è¦‹ç–¾ç—…ï¼ç‡Ÿé¤Šç—‡">${list(d.diseases)}</td>
      <td data-label="åŸºå› ç¼ºé™·ï¼çˆ­è­°å“ç³»">${list(d.genetics)}</td>
    </tr>`;
  }).join('');
})();

/* ====== æ®µä½è·³è½‰ï¼ˆ1/2/3ï¼‰ ====== */
function mountPager(pager){
  const box=document.querySelector(pager.dataset.pager); if(!box) return;
  function jump(dir, step){
    const span = box.clientWidth * (step===1?0.33:step===2?0.66:0.95);
    box.scrollTo({ left: box.scrollLeft + (dir==='right'?span:-span), behavior:'smooth' });
  }
  pager.addEventListener('click', e=>{
    const b=e.target.closest('.btn'); if(!b) return;
    const dir=b.dataset.dir, step=+b.dataset.step||1;
    if(dir) jump(dir, step);
  });
}
document.querySelectorAll('.pager[data-pager]').forEach(mountPager);

/* ====== è¡Œå‹•ç‰ˆæŠ½å±œï¼šFABã€èƒŒæ™¯ã€å³æ»‘é–‹å•Ÿ ====== */
const sidebar = document.getElementById('sidebar');
const backdrop = document.getElementById('backdrop');
const menuFab = document.getElementById('menuFab');
function openDrawer(){ sidebar.classList.add('open'); backdrop.classList.add('show'); menuFab.setAttribute('aria-expanded','true'); }
function closeDrawer(){ sidebar.classList.remove('open'); backdrop.classList.remove('show'); menuFab.setAttribute('aria-expanded','false'); }
menuFab.addEventListener('click', ()=> sidebar.classList.contains('open') ? closeDrawer() : openDrawer());
function isMobileLike(){
  const m = document.documentElement.getAttribute('data-mode');
  return m === 'mobile' || (m !== 'desktop' && matchMedia('(max-width:1023px)').matches);
}

// é»å´æ¬„ä»»ä¸€ç›®éŒ„ â†’ åˆ‡æ›é¢æ¿ä¸¦é—œæŠ½å±œï¼ˆæ‰‹æ©Ÿ / è‡ªå‹•æ¨¡å¼ï¼‰
document.addEventListener('click', (e) => {
  const link = e.target.closest('.navlink');
  if (!link) return;
  showPanel(link.dataset.section);
  if (isMobileLike() && sidebar.classList.contains('open')) closeDrawer();
});

// Esc é—œæŠ½å±œï¼›è¦–çª—è®Šæˆæ¡Œæ©Ÿå¯¬åº¦è‡ªå‹•æ”¶å›
document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeDrawer(); });
addEventListener('resize', () => { if (!isMobileLike()) closeDrawer(); });

backdrop.addEventListener('click', closeDrawer);
function isMobileLike(){
  const root = document.documentElement;
  const forced = root.getAttribute('data-mode');
  return forced === 'mobile' ||
         (forced !== 'desktop' && window.matchMedia('(max-width:1023px)').matches);
}

// é‚Šç·£å³æ»‘æ‰‹å‹¢ï¼šèµ·é»é è¿‘å·¦ç·£ä¸”å‘å³å¿«é€Ÿæ»‘å‹•æ™‚é–‹å•Ÿ
(function edgeSwipeOpen(){
  let x0=null, y0=null, t0=0;
  function onStart(e){
    const t=e.touches?e.touches[0]:e;
    x0=t.clientX; y0=t.clientY; t0=Date.now();
  }
  function onEnd(e){
    if(x0==null) return;
    const t=e.changedTouches?e.changedTouches[0]:e;
    const dx=t.clientX-x0, dy=t.clientY-y0, dt=Date.now()-t0;
    const nearLeft = x0<=24;
    if(nearLeft && dx>60 && Math.abs(dx)>Math.abs(dy) && dt<500){
      openDrawer();
    }
    x0=y0=null;
  }
  document.addEventListener('touchstart', onStart, {passive:true});
  document.addEventListener('touchend', onEnd, {passive:true});
})();

/* ====== ä¾†æºè³‡æ–™ ====== */
document.getElementById('now').textContent = new Date().toLocaleString();
const references = [
  { url: "https://www.merckvetmanual.com/management-and-nutrition/nutrition-exotic-and-zoo-animals/nutrition-in-reptiles", note: "MSD Vet Manualï¼šReptile & Exotic Nutrition" },
  { url: "https://vcahospitals.com/know-your-pet/common-diseases-of-tortoises", note: "VCAï¼šé™¸é¾œå¸¸è¦‹ç–¾ç—…/é‡‘å­—å¡”èƒŒ" },
  { url: "https://www.petmd.com/reptile/conditions/musculoskeletal/metabolic-bone-disease-mbd-reptiles", note: "PetMDï¼šçˆ¬èŸ² MBDï¼ˆCa/D3ï¼‰" },
  { url: "https://www.merckvetmanual.com/management-and-nutrition/nutrition-exotic-and-zoo-animals/nutrition-in-snakes", note: "MSDï¼šè›‡é¡ç‡Ÿé¤Š/ç…§è­·" },
  { url: "https://www.dvm360.com/view/how-i-treat-gastrointestinal-stasis-small-herbivores-proceedings", note: "DVM360ï¼šå°å‹è‰é£Ÿå“ºä¹³ GI stasis" },
  { url: "https://www.merckvetmanual.com/all-other-pets/rabbits/disorders-and-diseases-of-rabbits", note: "MSDï¼šå…”â€”å­å®®è…ºç™Œç­‰" },
  { url: "https://www.merckvetmanual.com/all-other-pets/guinea-pigs/disorders-and-diseases-of-guinea-pigs", note: "MSDï¼šå¤©ç«ºé¼ â€”ç¶­ä»–å‘½Cç¼ºä¹" },
  { url: "https://www.merckvetmanual.com/exotic-and-laboratory-animals/sugar-gliders/overview-of-sugar-gliders", note: "MSDï¼šèœœè¢‹é¼¯â€”æ¦‚è«–/ç‡Ÿé¤Š" },
  { url: "https://www.merckvetmanual.com/multimedia/table/feeding-your-sugar-glider", note: "MSDï¼šèœœè¢‹é¼¯é¤µé£Ÿè¡¨" },
  { url: "https://pmc.ncbi.nlm.nih.gov/articles/PMC7258705/", note: "GI stasis ç¶œè¿°ï¼ˆ2020ï¼‰" },
  { url: "https://pmc.ncbi.nlm.nih.gov/articles/PMC9377635/", note: "çƒèŸ’ Spider å…§è€³è®Šç•°èˆ‡ wobbleï¼ˆ2022ï¼‰" },
  { url: "https://pmc.ncbi.nlm.nih.gov/articles/PMC4935766/", note: "è±¹ç´‹å®ˆå®® Cryptosporidium varaniiï¼ˆ2016ï¼‰" }
];
document.getElementById('dev-refs').innerHTML =
  references.map(r => `<li><a class="link" href="${r.url}" target="_blank" rel="noopener">${r.note}</a></li>`).join('');

/* ====== æ–°åœ–è¡¨æ‡‰ç”¨ ====== */
let chartAppReady = false;
let chart;                  // Chart.js instance
let chartType = 'pie';      // 'pie' | 'bar'
let current = Object.keys(DATA)[2] || Object.keys(DATA)[0];
let focusKey = null;        // 'essential' | 'optional' | 'avoid' | 'not' | null
let notedIndex = null;      // 0..3 æˆ– null

const $ = sel => document.querySelector(sel);
const LABELS = { essential:'å¿…éœ€', optional:'å¯é¸', avoid:'é¿å…', not:'ä¸å»ºè­°' };

function getTextOf(d){
  return {
    essential: d.details.essential || 'â€”',
    optional:  d.details.optional  || 'â€”',
    avoid:     d.details.avoid     || 'â€”',
    not:       d.details.not       || 'â€”',
  };
}
function datasetFor(spec){
  const d = DATA[spec];
  const vals = [d.essential,d.optional,d.avoid,d.not];
  return { d, vals, sum: vals.reduce((a,b)=>a+b,0), text: getTextOf(d) };
}
function percent(v, sum){ return sum ? Math.round(v*100/sum) : 0; }
function keyByIndex(i){ return ['essential','optional','avoid','not'][i]; }

function syncToolbar(){
  document.documentElement.setAttribute('data-ctype', chartType);
  document.querySelectorAll('#cToolbar .btn')
    .forEach(b=>b.classList.toggle('active', b.dataset.ctype===chartType));
}
function setChartType(t){ chartType=t; syncToolbar(); renderChart(); }

function renderSpeciesChips(){
  const wrap = $('#speciesChips'); wrap.innerHTML='';
  Object.keys(DATA).forEach(name=>{
    const b=document.createElement('button');
    b.className='chip'; b.textContent=name;
    b.onclick=()=>{ current=name; focusKey=null; notedIndex=null; renderAll(); };
    if(name===current) b.classList.add('active');
    wrap.appendChild(b);
  });
}

function mountLegend(text){
  $('#l-eg').textContent = text.essential;
  $('#l-op').textContent = text.optional || 'â€”';
  $('#l-av').textContent = text.avoid || 'â€”';
  $('#l-no').textContent = text.not   || 'â€”';
  document.querySelectorAll('.legend .item').forEach((it)=>{
    const key = it.dataset.key;
    it.onclick = () => {
      focusKey = (focusKey===key?null:key);
      notedIndex = ['essential','optional','avoid','not'].indexOf(key);
      highlightBlocks();
      showNoteAtIndex(notedIndex);
    };
  });
}

function renderBlocks(){
  const { d, sum, text } = datasetFor(current);
  const map = [
    ['essential','green'],
    ['optional','yellow'],
    ['avoid','red'],
    ['not','redlite'],
  ];
  const box = $('#blocks'); box.innerHTML = '';
  map.forEach(([key, tone])=>{
    const pct = percent(d[key], sum);
    const el = document.createElement('div');
    el.className = `blk ${tone}`; el.dataset.key = key;
    el.innerHTML = `
      <h4>${LABELS[key]}ï¼ˆ ${pct}% ï¼‰</h4>
      <div>${(text[key]||'â€”')
        .replace(/â›”/g,'<span style="color:#ff6b6b">â›”</span>')
        .replace(/âš ï¸/g,'<span style="color:#facc15">âš ï¸</span>')}</div>`;
    el.onclick=()=>{ 
      const idx = ['essential','optional','avoid','not'].indexOf(key);
      focusKey=(focusKey===key?null:key);
      notedIndex = (notedIndex===idx ? null : idx);
      highlightBlocks(); 
      showNoteAtIndex(notedIndex);
    };
    box.appendChild(el);
  });
  highlightBlocks();
}
function highlightBlocks(){
  document.querySelectorAll('#blocks .blk').forEach(el=>{
    el.classList.toggle('hl', focusKey && el.dataset.key===focusKey);
  });
}

function showNoteAtIndex(idx){
  const note = $('#note');
  if(chart==null || idx==null || idx<0){ note.hidden = true; return; }
  const { d, sum, text } = datasetFor(current);
  const key = keyByIndex(idx);
  const label = LABELS[key];
  const val = d[key];
  const pct = percent(val, sum);
  note.innerHTML = `
    <div class="head"><span class="dot" style="background:${COLORS[key]}"></span>${label} Â· ${val}ï¼ˆ${pct}%ï¼‰</div>
    <div>${text[key] || 'â€”'}</div>
  `;
  const elem = chart.getDatasetMeta(0).data[idx];
  if(!elem){ note.hidden = true; return; }
  const pos = elem.tooltipPosition();
  const canvas = chart.canvas;
  const parent = $('#chartBox');
  const rectCanvas = canvas.getBoundingClientRect();
  const rectParent = parent.getBoundingClientRect();
  const left = (rectCanvas.left - rectParent.left) + pos.x;
  const top  = (rectCanvas.top  - rectParent.top)  + pos.y;
  note.style.left = left + 'px';
  note.style.top  = top  + 'px';
  note.hidden = false;
}

function renderChart(){
  const ctx = $('#chartCanvas').getContext('2d');
  if(chart) chart.destroy();
  const { d, vals, sum, text } = datasetFor(current);
  const labels = [LABELS.essential, LABELS.optional, LABELS.avoid, LABELS.not];
  const colors = [COLORS.essential, COLORS.optional, COLORS.avoid, COLORS.not];
  $('#currentName').textContent = current;
  syncToolbar();

  if(window.Chart){
    Chart.defaults.font.family = getComputedStyle(document.body).fontFamily;
    Chart.defaults.devicePixelRatio = window.devicePixelRatio || 1;
  }

  const baseTooltip = { callbacks:{ label:(c)=>`${c.label}: ${c.raw}ï¼ˆ${Math.round(c.raw*100/Math.max(1,sum))}%ï¼‰` } };

  if(chartType==='pie'){
    chart = new Chart(ctx,{
      type:'pie',
      data:{ labels, datasets:[{ data: vals, backgroundColor: colors, borderWidth:2 }] },
      options:{
        responsive:true, maintainAspectRatio:true, aspectRatio:1,
        plugins:{ legend:{ display:false }, tooltip: baseTooltip },
        onClick:(_, els)=>{
          if(!els.length){ notedIndex=null; showNoteAtIndex(null); return; }
          const idx = els[0].index;
          const key = keyByIndex(idx);
          focusKey = (focusKey===key ? null : key);
          notedIndex = (notedIndex===idx ? null : idx);
          highlightBlocks();
          showNoteAtIndex(notedIndex);
        }
      }
    });
  }else{
    chart = new Chart(ctx,{
      type:'bar',
      data:{ labels, datasets:[{ label:'å››é¡æŒ‡æ¨™', data: vals, backgroundColor: colors, borderRadius:6 }] },
      options:{
        responsive:true, maintainAspectRatio:false,
        scales:{
          y:{ beginAtZero:true, ticks:{ precision:0 } },
          x:{ ticks:{ color:'#cbd5e1' } }
        },
        plugins:{ legend:{ display:false }, tooltip: baseTooltip },
        onClick:(_, els)=>{
          if(!els.length){ notedIndex=null; showNoteAtIndex(null); return; }
          const idx = els[0].index;
          const key = keyByIndex(idx);
          focusKey = (focusKey===key ? null : key);
          notedIndex = (notedIndex===idx ? null : idx);
          highlightBlocks();
          showNoteAtIndex(notedIndex);
        }
      }
    });
  }
  showNoteAtIndex(notedIndex);
}

function ensureChartApp(){
  if(chartAppReady) return;
  document.getElementById('cToolbar').addEventListener('click', (e)=>{
    const b=e.target.closest('.btn[data-ctype]'); if(!b) return;
    setChartType(b.dataset.ctype);
  });
  chartAppReady = true;
  renderAll();
}

function renderAll(){
  const { text } = datasetFor(current);
  renderSpeciesChips();
  mountLegend(text);
  renderBlocks();
  renderChart();
}

/* ====== å·¦å³ã€Œæ»‘æ‰‹å‹¢ã€æ›é¢æ¿ï¼ˆä¿ç•™ï¼‰ï¼Œé¿å…èˆ‡æŠ½å±œè¡çª ====== */
(function swipePanels(){
  let x0=null, y0=null, t0=0;
  function onStart(e){ const t=e.touches?e.touches[0]:e; x0=t.clientX; y0=t.clientY; t0=Date.now(); }
  function onEnd(e){
    if(x0==null) return;
    const t=e.changedTouches?e.changedTouches[0]:e;
    const dx=t.clientX-x0, dy=t.clientY-y0, dt=Date.now()-t0;
    const startedAtEdge = x0<=24;
    x0=y0=null;
    if(startedAtEdge && dx>60 && Math.abs(dx)>Math.abs(dy) && dt<600){ return; }
    if(Math.abs(dx)>60 && Math.abs(dx)>Math.abs(dy) && dt<600){
      const list = navlinks;
      const idx = list.findIndex(a=>a.classList.contains('active'));
      const next = dx<0 ? Math.min(list.length-1, idx+1) : Math.max(0, idx-1);
      showPanel(list[next].dataset.section);
    }
  }
  document.addEventListener('touchstart', onStart, {passive:true});
  document.addEventListener('touchend', onEnd, {passive:true});
})();

/* ====== åˆå§‹åŒ– ====== */
const initial = (location.hash.match(/view=(\w+)/)||[])[1] || 'table';
applyView(initial);
// ====== Topbarã€Œâ†©ï¸ åˆ‡æ› Appã€æŒ‰éˆ• ======
(function(){
  const btn = document.getElementById('toApps');
  if(!btn) return;
  function mobileLike(){
    const root = document.documentElement;
    const forced = root.getAttribute('data-mode');
    return forced === 'mobile' || (forced !== 'desktop' && matchMedia('(max-width:1023px)').matches);
  }
  function update(){
    const active = document.querySelector('.panel.active')?.dataset.panel;
    btn.style.display = active === 'apps' ? 'none' : '';
  }
  const _showPanel = showPanel;
  showPanel = function(name){
    _showPanel(name);
    update();
  };
  btn.addEventListener('click', ()=>{
    showPanel('apps');
    if(mobileLike() && typeof closeDrawer==='function') closeDrawer();
    document.getElementById('content')?.scrollTo({top:0, behavior:'smooth'});
  });
  update();
})();
</script>
</body>
</html>
